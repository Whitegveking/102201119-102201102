<!-- pages/projectDetail/projectDetail.wxml -->
<view class="container">
  <!-- 项目详情展示 -->
  <view class="project-details">
    <text class="project-name">{{project.name}}</text>
    <text class="project-description">{{project.description}}</text>
    <view class="creator-info">
      <icon type="user" size="20" color="#555"></icon>
      <text class="creator-text">创建者: {{creatorUsername}}</text>
    </view>
    <view class="member-count">
      <icon type="team" size="20" color="#555"></icon>
      <text>参与人数: {{project.members.length}}</text>
    </view>
    <!-- 项目状态展示 -->
    <view class="project-status-display">
      <icon type="status" size="20" color="#555"></icon>
      <text class="status-text">状态: {{project.status}}</text>
    </view>
    <!-- 更改项目状态按钮，仅创建者可见 -->
    <button wx:if="{{isCreator}}" class="change-status-btn" bindtap="openStatusPicker">更改状态</button>
  </view>

  <!-- 操作按钮 -->
  <view class="project-actions">
    <!-- 加入项目按钮（仅未加入且非创建者） -->
    <button 
      wx:if="{{!isCreator && !isMember}}" 
      class="join-btn" 
      bindtap="joinProject" 
      data-id="{{projectId}}"
    >
      加入项目
    </button>

    <!-- 退出项目和删除项目按钮（仅已加入或为创建者） -->
    <view class="action-buttons" wx:if="{{isMember || isCreator}}">
      <button 
        wx:if="{{isMember}}" 
        class="small-btn exit-btn" 
        bindtap="exitProject" 
        data-id="{{projectId}}"
      >
        退出项目
      </button>
      <button 
        wx:if="{{isCreator}}" 
        class="small-btn delete-btn" 
        bindtap="deleteProject" 
        data-id="{{projectId}}"
      >
        删除项目
      </button>
    </view>
  </view>

  <!-- 更改项目状态选择器 -->
  <view class="picker-overlay" wx:if="{{showStatusPicker}}" catchtap="closeStatusPicker">
    <view class="picker-modal" catchtap="preventClose">
      <view class="picker-header">
        <text class="picker-title">选择项目状态</text>
        <icon type="close" size="24" bindtap="closeStatusPicker"></icon>
      </view>
      <picker mode="selector" range="{{availableStatuses}}" bindchange="handleStatusChange" value="{{selectedStatusIndex}}">
        <view class="picker-container">
          <text>当前状态: {{selectedStatus}}</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- 聊天室消息展示部分（如果有需要，可以保留或移除） -->
  <view class="chat-section">
    <text class="section-title">聊天室</text>
    <scroll-view class="chat-container" scroll-y="true">
      <block wx:for="{{messages}}" wx:key="index">
        <view class="message-item {{item.senderOpenid === openid ? 'own-message' : 'other-message'}}">
          <view class="message-header">
            <text class="message-sender">{{item.senderUsername}}</text>
            <text class="message-timestamp">{{formatTimestamp(item.timestamp)}}</text>
          </view>
          <text class="message-content">{{item.content}}</text>
        </view>
      </block>
    </scroll-view>

    <!-- 发送消息输入框 -->
    <view class="message-input-container">
      <input
        class="message-input"
        placeholder="输入消息..."
        value="{{newMessage}}"
        bindinput="handleMessageInput"
      />
      <button class="send-btn" bindtap="sendMessage">发送</button>
    </view>
  </view>
</view>
