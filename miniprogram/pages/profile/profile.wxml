<!-- pages/profile/profile.wxml -->
<view class="container">
  <!-- 用户信息展示 -->
  <view class="user-info">
    <!-- 如果用户有头像，显示头像 -->
    <block wx:if="{{user.avatarUrl}}">
      <image class="avatar" src="{{user.avatarUrl}}" mode="aspectFill"></image>
    </block>
    <!-- 如果用户没有头像，显示首字母占位符 -->
    <block wx:else>
      <view class="avatar-placeholder">
        <text class="avatar-initial">{{getInitial(user.nickName)}}</text>
      </view>
    </block>
    <view class="user-details">
      <text class="nickName">{{user.nickName || '未设置昵称'}}</text>
      <text class="username">用户名: {{user.username || '未设置'}}</text>
      <button class="edit-btn" bindtap="openEditUsernameModal">编辑用户名</button>
    </view>
  </view>

  <!-- 用户发布的项目 -->
  <view class="section">
    <text class="section-title">我发起的项目</text>
    <block wx:if="{{createdProjects.length > 0}}">
      <block wx:for="{{createdProjects}}" wx:key="_id">
        <view class="project-item">
          <view class="project-info" bindtap="goToDetail" data-id="{{item._id}}">
            <text class="project-name">{{item.name}}</text>
            <text class="project-description">{{item.description}}</text>
            <text class="member-count">参与人数: {{item.members.length}}</text>
          </view>
          <view class="project-actions">
            <button class="small-btn delete-btn" bindtap="deleteProject" data-id="{{item._id}}">删除</button>
            <button class="small-btn exit-btn" bindtap="exitProject" data-id="{{item._id}}">退出</button>
          </view>
        </view>
      </block>
    </block>
    <block wx:else>
      <text class="no-projects">您尚未发起任何项目。</text>
    </block>
  </view>

  <!-- 用户加入的项目 -->
  <view class="section">
    <text class="section-title">我参与的项目</text>
    <block wx:if="{{joinedProjects.length > 0}}">
      <block wx:for="{{joinedProjects}}" wx:key="_id">
        <view class="project-item">
          <view class="project-info" bindtap="goToDetail" data-id="{{item._id}}">
            <text class="project-name">{{item.name}}</text>
            <text class="project-description">{{item.description}}</text>
            <text class="member-count">参与人数: {{item.members.length}}</text>
          </view>
          <view class="project-actions">
            <button class="small-btn exit-btn" bindtap="exitProject" data-id="{{item._id}}">退出</button>
          </view>
        </view>
      </block>
    </block>
    <block wx:else>
      <text class="no-projects">您尚未加入任何项目。</text>
    </block>
  </view>

  <!-- 编辑用户名的模态框 -->
  <view class="modal-overlay" wx:if="{{showEditUsernameModal}}">
    <view class="modal-content">
      <text class="modal-title">编辑用户名</text>
      <input
        class="modal-input"
        placeholder="输入新的用户名"
        value="{{newUsername}}"
        bindinput="handleEditUsernameInput"
      />
      <view class="modal-buttons">
        <button class="modal-btn cancel-btn" bindtap="closeEditUsernameModal">取消</button>
        <button class="modal-btn confirm-btn" bindtap="submitEditUsername">确认</button>
      </view>
    </view>
  </view>
</view>
